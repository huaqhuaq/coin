<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta charset="UTF-8">
    <title>login</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login.css">
</head>

<body>
    <div class="login" id="login">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 text-center">
                    <a href="" target="_blank" class="logo">
                        <img :src="logo" alt="logo" class="img-responsive">
                    </a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 col-md-offset-4">
                    <div class="login-form animated animated-fast fadeIn">
                        <h2>登录</h2>
                        <el-form :model="ruleForm" status-icon :rules="rules" ref="ruleForm">
                            <el-form-item prop="phone">
                                <img src="img/pic_phone.png" alt="pic_phone" class="input-group-icon">
                                <el-input type="text" v-model="ruleForm.phone" placeholder="请输入手机号码" auto-complete="off"></el-input>
                            </el-form-item>
                            <el-form-item prop="pass">
                                <img src="img/pic_password.png" alt="pic_password" class="input-group-icon">
                                <el-input type="password" v-model="ruleForm.pass" placeholder="请输入密码" auto-complete="off"></el-input>
                            </el-form-item>
                            <div class="form-group clearfix">
                                <a href="signup.html">注册账号</a>
                                <a href="forgot.html" class="pull-right">忘记密码？</a>
                            </div>
                            <el-form-item class="btn-wrap">
                                <el-button type="primary" class="btn btn-primary btn-lg btn-block" @click="submitForm('ruleForm')">登录</el-button>
                            </el-form-item>
                        </el-form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/vue.js"></script>
    <script src="js/index.js"></script>
    <script src="js/axios.min.js"></script>
    <script>
    var validatePhone = (rule, value, callback) => {
        var re = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/
        if (!re.test(value)) {
            callback(new Error('请输入正确格式的手机号码'));
        } else {
            callback();
        }
    };

    var login = new Vue({
        el: '#login',
        data: {
            logo: 'img/pic_logo_3.png',
            ruleForm: {
                phone: '',
                pass: ''
            },
            rules: {
                phone: [
                    { required: true, message: '请输入手机号码', trigger: 'blur' },
                    { validator: validatePhone }
                ],
                pass: [
                    { required: true, message: '请输入密码', trigger: 'change' }
                ]
            }
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        console.log('success submit!');
                        axios.post('/mining/frontend/web/mining/login', {
                            username: this.ruleForm.phone,
                            password: this.ruleForm.pass
                        }).then(function(response) {
                            console.log(response)
                            var code = response.data.code
                            if(code == 200) {
                                // window.localStorage.Token = response.data.auth_key
                                // window.location.href = './index.html'
                                axios.post('/mining/frontend/web/inside/inviter', {
                                    username: login.ruleForm.phone,
                                    auth_key: response.data.auth_key
                                }).then(function(res) {
                                    console.log(res)
                                })
                            } else if(code == 201) {
                                login.$message.error('账号不存在!');
                            } else if(code == 202) {
                                login.$message.error('账户密码不匹配!');
                            }
                        }).catch(function(error) {
                            console.log(error)
                        });
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            }
        }
    })
    </script>
</body>

</html>